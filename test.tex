\documentclass{article}
\usepackage{a4wide}
\usepackage{chrono}

\begin{document}

\def\rotate{\pgfkeys{/tikz/rotate=90,/tikz/transform shape}}

\def\test{
  \AB{DATA1}
  \Await
  \AB[lost,color=red,dashed]{lost}
  \BA[lost]{aussi}
  \AB[bad,thin]{bad}
  \AB[bad,lost]{badlost}
  \AB{DATA4}
  \AB[prop=1mm]{prop=1mm}
  \AB[text=green,font={\itshape\rmfamily}]{DATA6}
  \AB[prop]{prop}
  \AB{DATA7}
  \AB[prop=2cm]{prop=2cm}
  \AB{DATA8}
}
\def\testi{
  \AB{DATA1}
  \AB{DATA2}
  \AB{DATA3}
  \BA{ACK1}
  \BA{ACK2}
  \BA{ACK3}
  \AB{DATA4}
  \AB[prop=2cm]{prop=2cm}
  \BA{ACK}
  \fullduplex

  \BA{ACK4}
  \AB{DATA5}
  \BA{ACK5}
%  \halfduplex
  \AB[prop=2cm]{prop=2cm}
  \BwaitA
  \BA{ACK}
}
\def\testii{
  \AB{DATA1}
  \AB{DATA2}
  \BA{ACK3}
  \pgfkeys{/chrono/space same=5mm}
  \AB{DATA1}
  \AB{DATA2}
  \BA{ACK3}}
\def\testiii{
  \AB[bad]{DATA1}
  \BA[bad]{DATA1}
  \chronosyncfalse
  \AB[bad]{DATA2}
  \AB{DATA3}
  \AB{DATA4}
  \BA{DATA3}
  \BA[bad]{DATA4}}

\def\testiv{
  \AB{DATA1}
  \ABtimed[late=3cm]{DATA2}{3cm}{temporisateur}
  \AB{DATA3}
%  \Awaittimer
  \AB{DATA2}}

\def\testacktimer{
 \AB{DATA1}
 \BAdelayed{5mm}{ack}{ACK}
 \fullduplex
 \AB{DATA1}
 \BAdelayed{5mm}{ack}{ACK}
 \AB{DATA1}
 \BAdelayed{5mm}{ack}{ACK}
 \BA{DATA1}
 \ABdelayed{5mm}{ack}{ACK}}

\def\testacktimeri{
 \BA{DATA}
 \ABstop{1cm}{ack}{5mm}{DATA}
 \BA{ok}
 \ABstop{1cm}{ack}{5mm}{DATA}
 \AB{DATA}
 \BAstop{1cm}{ack}{5mm}{DATA}
 \AB{yo}
 \BAstop{1cm}{ack}{5mm}{DATA}}

\def\testvii{
  \AB{DATA1}
  \ABtimed[trans=3cm]{DATA2}{3cm}{temporisateur}
  \BAcancel{ACK}
  \Awaittimer
  \AB{DATA3}
  \AB{DATA2}}

\def\testviii{
  \ABtimed{DATA1}{3cm}{retrans}
  \Awaittimer
%  \AB{toto}
  \ABtimed{DATA1}{3cm}{retrans}
  \BAcancel{ACK}}

\def\testix{
  \ABtimedi{DATA}{3cm}{yo !}
  \BAcanceli{yoo}
  \BAtimed{DATA}{2cm}{gah}
  \ABcancel{feu}}

\def\testx{
  \AB{DATA0}
  \ABtimed{DATA1}{3cm}{temporisateur1}
  \BAcancel{ACK}
  \ABtimedi{DATA2}{3cm}{temporisateur2}
  \BAcanceli{ACK}
  \ABtimed{DATA3}{3cm}{tempo3}  
  \AB{DATA2}}

\def\testxi{
  \BA{DATA1}
  \BAtimed{DATA1}{3cm}{temporisateur1}
  \ABcancel{ACK}
  \BAtimedi{DATA2}{3cm}{temporisateur2}
  \ABcanceli{ACK}
  \BAtimed{DATA3}{3cm}{tempo3}  
  \BA{DATA2}}

\def\testlater{
  \AB{DATA1}
  \ABtimed{DATA2}{8cm}{temporisateur}
   \ABtimedi{DATA3}{6cm}{temporisateur2}
  \later{2cm}
  \BAcancel{ACK}
  \BAcanceli{ACK}
}

\def\testlateri{
  \BA{DATA1}
  \BAtimed{DATA2}{8cm}{temporisateur}
  \BAtimedi{DATA3}{6cm}{temporisateur2}
  \later{2cm}
  \ABcancel{ACK}
  \ABcanceli{ACK}
}

\def\testxii{
  \Astate{Closed}\Bstate{Closed}
  \Await         \Bwait
  \Await         \Bactionstate{passive open}{listen}
  \Aactionstate{active open}{Syn-Sent}
  \AB{SYN}
                 \Bstate{SynRecvd}
                 \BA{SYN+ACK}
  \Astate{Established}
  \AB{ACK}
                 \Bstate{Established}

\later{3cm}

  \Astate{Established}\Bstate{Established}
  \Await
  \Aactionstate{close}{FinWait1}
  \AB{FIN}
                      \Bstate{CloseWait}
                      \BA{ACK}
  \Astate{FinWait2}

\later{2cm}

                      \Bactionstate{close}{LastAck}
                      \BA{FIN}
  \Astate{TimeWait}
  \ABtimed{ACK}{5cm}{2xMSL}
                      \Bstate{Closed}
\later{2cm}
  \Awaittimer
  \Astate{Closed}
}
\def\testxiii{
  \AB{DATA1}
  \AB{DATA2}
  \BA{ACK3}
  \AB{DATA3}
  \BAdelayed{1cm}{ack}{ACK4}}

\def\testxiv{
\pgfkeys{/chrono/.cd,timeri offset=3mm}
                      \Bactionstate{close}{LastAck}
                      \BAtimed{FIN}{3.5cm}{retrans}
  \Astate{TimeWait}
  \ABtimed[lost]{ACK}{5cm}{2xMSL}
                      \Bwaittimer
                      \BAcancel{FIN}
  \ABtimedi{ACK}{5cm}{2xMSL}

                      \Bstate{Closed}
  \Awaittimeri
  \Astate{Closed}
}

\begin{chrono}[color=blue,cross for lost]
  \test
\end{chrono}
\hfill
\begin{hchrono}[cross for lost,trans=1.5cm]
\rotate
  \test
\end{hchrono}
\vfill
\begin{chrono}[width=2cm]
\testi
\end{chrono}
\hfill
\begin{hchrono}[width=1cm]
\rotate\testi
\end{hchrono}
\vfill
\begin{chrono}
\testii\end{chrono}
\hfill
\begin{hchrono}
\rotate
\testii\end{hchrono}
\vfill
\begin{chrono}[width=3.5cm,prop=1cm]
\testiii
\end{chrono}
\hfill
\begin{hchrono}[width=3.5cm,prop=1cm]
\testiii
\end{hchrono}
\vfill
\begin{chrono}
\testiv
\end{chrono}
\hfill
\begin{hchrono}
\testiv
\end{hchrono}
\vfill

\subsubsection*{ACK timers}

\begin{chrono}[A,B]
  \testacktimer
\end{chrono}
\hfill
\begin{hchrono}[A,B]
  \testacktimer
\end{hchrono}
\vfill
\begin{chrono}
 \testacktimeri
\end{chrono}
\hfill
\begin{hchrono}
 \testacktimeri
\end{hchrono}
\vfill
\begin{chrono}[A=client,B=serveur]
\testvii
\end{chrono}
\begin{hchrono}[A=client,B=serveur]
\testvii
\end{hchrono}
\vfill
\begin{chrono}[timer time offset=2mm]
\testviii
\end{chrono}
\hfill
\begin{hchrono}
\testviii
\end{hchrono}
\vfill
\begin{chrono}
\testix
\end{chrono}
\hfill
\begin{hchrono}
\testix
\end{hchrono}
%\vfill

\subsubsection*{Timers}

\begin{chrono}[]
\testx
\end{chrono}
\hfill
\begin{chrono}[]
\testxi
\end{chrono}

\begin{hchrono}
\testx
\end{hchrono}

\bigskip

\begin{hchrono}
\testxi
\end{hchrono}
\vfill

\subsubsection*{Timers: timerleftbelow}

{\pgfkeys{/chrono/timerleftbelow}
\begin{chrono}[]
\testx
\end{chrono}
\hfill
\begin{chrono}[]
\testxi
\end{chrono}

\begin{hchrono}
\testx
\end{hchrono}

\bigskip

\begin{hchrono}
\testxi
\end{hchrono}
}

\subsubsection*{Timers: timerleftbottomup}

{\pgfkeys{/chrono/timerleftbottomup}
\begin{chrono}[]
\testx
\end{chrono}
\hfill
\begin{chrono}[]
\testxi
\end{chrono}

\begin{hchrono}
\testx
\end{hchrono}

\bigskip

\begin{hchrono}
\testxi
\end{hchrono}
}
\vfill

\subsubsection*{Timers: later}

\begin{chrono}
  \testlater
\end{chrono}
\begin{chrono}[timerleftbelow]
  \testlater
\end{chrono}
\begin{chrono}[timerleftbottomup]
  \testlater
\end{chrono}
\begin{chrono}
  \testlateri
\end{chrono}

%\hspace{-2cm}

\subsubsection*{Timers: timed, delayed, stop, late, cancel}

\def\testtimers{
  \AB[timed={3cm}{toto}]{timed}
  \BA[timed={3cm}{titi},cancel]{timed,cancel}
  \AB[timed2={3cm}{toto},late]{timed,late}
  \BA[late=1cm,cancel2]{late,cancel}
  \BA[prop=12mm]{prop=12mm}
  }
\def\testtimersr{
  \BA[timed={3cm}{toto}]{timed}
  \AB[timed={3cm}{titi},cancel]{timed,cancel}
  \BA[timed2={3cm}{toto},late]{timed,late}
  \AB[late=1cm,cancel2]{late,cancel}
  \AB[prop=12mm]{prop=12mm}
  }
\def\testtimersi{
  \AB[delayed={1cm}{yup}]{delayed}
  \BA[delayed={1cm}{yop},timed={4cm}{yopyop}]{timed \& delayed}
  \AB[timed2={3cm}{timer2},delayed={1.5cm}{gah!},cancel]{d \& c \& t}

  \BA[stop2={1cm}{zz}{5mm},cancel2]{stop \& cancel}
  \BA{rien}
  \Await[2cm]
  \AB[stop={2cm}{stop}{1cm},late=2cm,timed2={3cm}{timed}]{s \& l \& t!}
}
\def\testtimersir{
  \BA[delayed={1cm}{yup}]{delayed}
  \AB[delayed={1cm}{yop},timed={4cm}{yopyop}]{timed \& delayed}
  \BA[timed2={3cm}{timer2},delayed={1.5cm}{gah!},cancel]{d \& c \& t}

  \AB[stop2={1cm}{zz}{5mm},cancel2]{stop \& cancel}
  \AB{rien}
  \Bwait[2cm]
  \BA[stop={2cm}{stop}{1cm},late=2cm,timed2={3cm}{timed}]{s \& l \& t!}
}
\begin{chrono}
 \testtimers 
\end{chrono}
\begin{chrono}
 \testtimersr 
\end{chrono}

\begin{chrono}
 \testtimersi 
\end{chrono}
\begin{chrono}
 \testtimersir
\end{chrono}


\subsubsection*{Send and receive notes}

\begin{chrono}
  \AB[snote=send note,rnote=receive note]{DATA}
  \BA[snoteoffset=6mm,rnoteoffset=1mm,snote=less close,rnote=closer]{DATA}
\end{chrono}

\subsubsection*{States and actions}

\begin{chrono}[prop=7mm,A=client,B=serveur,action time
  offset=0mm,action offset=2mm]
\testxii
\end{chrono}
\hfill
\begin{hchrono}[prop=7mm,A=client,B=serveur,trans]
\rotate
\testxii
\end{hchrono}
\vfill
\begin{chrono}[prop=0cm]
\testxiii
\end{chrono}
\begin{hchrono}%[prop=0cm]
\testxiii
\end{hchrono}

\begin{chrono}
\testxiv
\end{chrono}

\begin{hchrono}[shorts={FIN,ACK},A=toto,B=taratata]
\testxiv
\end{hchrono}

\subsubsection*{Laters}

\begin{chrono}
  \AB{DATA1}
  \later{1cm}
  \AB{DATA1}
  \later{2cm}
  \AB{DATA1}
  \later{3cm}
  \AB{DATA1}
  \later{4cm}
  \AB{DATA1}
  \later{2cm}
  \AB{DATA1}
  \later{2cm}
  \BA{DATA1}
  \later{1cm}  
\end{chrono}

\subsubsection*{Late frames, named positions}

\begin{chrono}
  \AB{DATA1}
  \AB[late=2cm]{DATA2}
  \AB[late,name=n2,rnote=named n2]{DATA3}
  \Bwaitlate
  \BA{ACK3}
  \Bwaitlate[n2]
  \BA[snote=waited for n2]{ACK4}
\end{chrono}
\begin{chrono}
  \BA{DATA1}
  \BA[late=2cm]{DATA2}
  \BA[late,name=n2,rnote=named n2]{DATA3}
  \Awaitlate
  \AB{ACK3}
  \Awaitlate[n2]
  \AB[snote=waited for n2]{ACK4}
\end{chrono}
\begin{chrono}
  \AB{DATA1}
  \AB[late=2cm]{DATA2}
  \Bwaitlate
  \BA{ACK3}
  \BA[late=2cm]{DATA2}
  \Awaitlate
  \AB{ACK3}
\end{chrono}

\subsubsection*{Filtering}

\def\testfilter{
  \AB[id=1]{DATA 1 (1)}
  \AB[id=2]{DATA 1 (2)}
  \AB[id=2]{DATA 2 (2)}
                      \BA[id=2]{RR 3 (2)}
  \AB[id=1]{DATA 2 (1)}
                      \BA[id=1]{RR 3 (1)}
}

\begin{chrono}
  \testfilter
\end{chrono}
\begin{chrono}[hide=1]
  \testfilter
\end{chrono}
\begin{chrono}[hide=2]
  \testfilter
\end{chrono}
\begin{chrono}[hide=1,hide=2]
  \testfilter
\end{chrono}

\subsubsection*{Filtering, styles, label styles}

{\derivestyle{id1}{default}{green}
\derivestyle{id1l}{labeldefault}{green!60}
\derivestyle{id2}{default}{blue,dashed}
\definestyle{id2l}{above,blue!60}
\setflowstyle{1}{id1}
\setflowlabelstyle{1}{id1l}
\setflowstyle{2}{id2}
\setflowlabelstyle{2}{id2l}
\begin{chrono}
  \testfilter
\end{chrono}
\begin{chrono}[hide=1]
  \testfilter
\end{chrono}
\begin{chrono}[hide=2]
  \testfilter
\end{chrono}
\begin{chrono}[hide=2]
  \definestyle{1b}{above,draw,orange,fill=orange!20,opacity=0.5}
  \setflowlabelstyle{1}{1b}
  \testfilter
\end{chrono}
}

\subsubsection*{Labels}

\def\testlabelii{
  \AB[label2=Yoooo !]{DATA 1}
  \AB[label2=Yoohi !]{DATA 2}
                      \BA[label2=Okay !]{RR 3}
                      \BA[label2=Youba !]{DATA 1}
  \AB[label2=Alone !]{}
  \AB{Alone}
}

\begin{chrono}
  \testlabelii
\end{chrono}
\begin{chrono}[show label2]
  \testlabelii
\end{chrono}
\begin{chrono}[show label2,hide label]
  \testlabelii
\end{chrono}

\subsubsection*{Per frame label style}

\def\testframelabelstyle{
  \AB{toto}
  \BA[label style=orange]{titi}
  \AB[label style={font=\scshape}]{tutu}
  \BA[label style={sloped=false,draw,fill=orange!20,opacity=0.75}]{tata}
  \AB{toutou}}
\begin{chrono}
\testframelabelstyle
\end{chrono}
\begin{hchrono}
\testframelabelstyle
\end{hchrono}

\end{document}
